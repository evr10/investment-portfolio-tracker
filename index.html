<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Analytics Dashboard</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Outfit', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        /*
          CSV DATA INTEGRATION GUIDE:
          
          To load your actual CSV files, replace the portfolioData object below.
          
          1. HOLDINGS FILES (holdings_2024.csv, holdings_2025.csv):
             - Parse CSV with columns: Account_Number, Asset_Class, Symbol, Description, Quantity, Price, Market_Value, Cost_Basis, Unrealized_Gain_Loss
             - Normalize account numbers: Remove hyphens (X90-845768 → X90845768)
             - Group by normalized Account_Number and sum Market_Value and Cost_Basis
             - Count unique holdings per account
          
          2. TRANSACTIONS FILE (transactions_2025.csv):
             - Parse CSV with columns: Account, Account Number, Action, Symbol, Amount, etc.
             - Normalize Account Number: Remove hyphens and spaces
             - Create account mapping: normalized number → friendly Account name
             - Sum transactions by Action type:
               * Purchases: Action contains "YOU BOUGHT" or look for negative amounts with buy-related actions
               * Sales: Action contains "YOU SOLD" or positive amounts with sell-related actions
               * Dividends Reinvested: Action = "REINVESTMENT"
             - Calculate Net Invested = Purchases + Dividends Reinvested - Sales
          
          3. ACCOUNT CONSOLIDATION:
             - Always use NORMALIZED account numbers as keys (no hyphens/spaces)
             - Display friendly names from transactions file "Account" column
             - Match across files using normalized numbers
        */

        // Helper function to normalize account numbers (remove hyphens and spaces)
        const normalizeAccountNumber = (accountNum) => {
            if (!accountNum) return '';
            return accountNum.toString().replace(/[-\s]/g, '');
        };

        // Sample data structure - replace with your actual CSV data
        const portfolioData = {
            // Account mapping: normalized number -> friendly name
            accountNames: {
                '235972478': 'Health Savings Account',
                'X90845768': 'Primary Portfolio',
                'Z21306611': 'Individual - TOD',
                'Z08638986': 'Joint WROS - TOD'
            },
            
            holdings2024: {
                totalValue: 617945.22,
                // Key by normalized account number
                accountsByNumber: {
                    '235972478': { value: 0, holdings: 0 },
                    'X90845768': { value: 393400, holdings: 20 },
                    'Z21306611': { value: 179200, holdings: 13 },
                    'Z08638986': { value: 45400, holdings: 2 }
                }
            },
            
            holdings2025: {
                totalValue: 836872.98,
                totalCostBasis: 648184.39,
                // Key by normalized account number
                accountsByNumber: {
                    '235972478': { value: 0, holdings: 0, costBasis: 0 },
                    'X90845768': { value: 575874.48, holdings: 20, costBasis: 393400 },
                    'Z21306611': { value: 208560.27, holdings: 13, costBasis: 179200 },
                    'Z08638986': { value: 52438.23, holdings: 2, costBasis: 45400 }
                }
            },
            
            transactions2025: {
                purchases: 23761.12,
                sales: 2389.68,
                dividendsReinvested: 8787.65,
                netInvested: 38239.17 // Buys + Divs - Sells
            }
        };

        // Lucide Icons as inline SVG components
        const TrendingUp = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Calendar = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const DollarSign = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const BarChart3 = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M3 3v18h18"></path>
                <path d="M18 17V9"></path>
                <path d="M13 17V5"></path>
                <path d="M8 17v-3"></path>
            </svg>
        );

        const PieChart = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path>
                <path d="M22 12A10 10 0 0 0 12 2v10z"></path>
            </svg>
        );

        const ArrowUpRight = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="7" y1="17" x2="17" y2="7"></line>
                <polyline points="7 7 17 7 17 17"></polyline>
            </svg>
        );

        const ArrowDownRight = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="7" y1="7" x2="17" y2="17"></line>
                <polyline points="17 7 17 17 7 17"></polyline>
            </svg>
        );

        const PortfolioDashboard = () => {
            const [activeTab, setActiveTab] = useState('alltime');

            // All-Time Performance Calculations
            const currentValue = portfolioData.holdings2025.totalValue;
            const costBasis = portfolioData.holdings2025.totalCostBasis;
            const unrealizedGain = currentValue - costBasis;
            const unrealizedGainPct = (unrealizedGain / costBasis) * 100;

            // 2025 Performance Calculations
            const startValue = portfolioData.holdings2024.totalValue;
            const endValue = portfolioData.holdings2025.totalValue;
            const netInflows = portfolioData.transactions2025.netInvested;
            const marketGain = endValue - (startValue + netInflows);
            const marketGainPct = (marketGain / (startValue + netInflows)) * 100;
            const totalChange = endValue - startValue;
            const totalChangePct = (totalChange / startValue) * 100;

            const formatCurrency = (value) => {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: 'USD',
                    minimumFractionDigits: 2
                }).format(value);
            };

            const formatPercent = (value) => {
                return `${value >= 0 ? '+' : ''}${value.toFixed(2)}%`;
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-slate-100 p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="mb-12">
                            <h1 className="text-5xl font-bold mb-3 bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
                                Portfolio Analytics
                            </h1>
                            <p className="text-slate-400 text-lg">Track your wealth journey with precision</p>
                        </div>

                        {/* Tab Navigation */}
                        <div className="flex gap-4 mb-8 border-b border-slate-800 pb-1">
                            <button
                                onClick={() => setActiveTab('alltime')}
                                className={`px-6 py-3 font-semibold text-lg transition-all duration-300 relative ${
                                    activeTab === 'alltime'
                                        ? 'text-emerald-400'
                                        : 'text-slate-500 hover:text-slate-300'
                                }`}
                            >
                                <span className="inline-flex items-center gap-2">
                                    <TrendingUp />
                                    All-Time Performance
                                </span>
                                {activeTab === 'alltime' && (
                                    <div className="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-emerald-400 to-cyan-400 rounded-full" />
                                )}
                            </button>
                            <button
                                onClick={() => setActiveTab('2025')}
                                className={`px-6 py-3 font-semibold text-lg transition-all duration-300 relative ${
                                    activeTab === '2025'
                                        ? 'text-cyan-400'
                                        : 'text-slate-500 hover:text-slate-300'
                                }`}
                            >
                                <span className="inline-flex items-center gap-2">
                                    <Calendar />
                                    2025 Year-in-Review
                                </span>
                                {activeTab === '2025' && (
                                    <div className="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-cyan-400 to-blue-400 rounded-full" />
                                )}
                            </button>
                        </div>

                        {/* Tab Content */}
                        {activeTab === 'alltime' && (
                            <div className="space-y-6 animate-fadeIn">
                                {/* Key Metrics */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-2xl p-6 hover:border-emerald-500/50 transition-all duration-300">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-slate-400 text-sm font-medium">Current Market Value</span>
                                            <DollarSign />
                                        </div>
                                        <div className="text-3xl font-bold text-emerald-400">{formatCurrency(currentValue)}</div>
                                    </div>

                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-2xl p-6 hover:border-blue-500/50 transition-all duration-300">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-slate-400 text-sm font-medium">Total Cost Basis</span>
                                            <BarChart3 />
                                        </div>
                                        <div className="text-3xl font-bold text-blue-400">{formatCurrency(costBasis)}</div>
                                    </div>

                                    <div className="bg-gradient-to-br from-emerald-900/30 to-cyan-900/30 backdrop-blur-sm border border-emerald-500/50 rounded-2xl p-6 shadow-lg shadow-emerald-500/20">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="text-slate-300 text-sm font-medium">Lifetime Unrealized Gain</span>
                                            <ArrowUpRight />
                                        </div>
                                        <div className="text-3xl font-bold text-emerald-400">{formatCurrency(unrealizedGain)}</div>
                                        <div className="text-sm text-emerald-400 mt-2 font-semibold">{formatPercent(unrealizedGainPct)}</div>
                                    </div>
                                </div>

                                {/* Holdings Breakdown */}
                                <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-2xl p-8">
                                    <h2 className="text-2xl font-bold mb-6 flex items-center gap-3">
                                        <PieChart />
                                        Holdings Breakdown
                                    </h2>
                                    <div className="space-y-4">
                                        {Object.entries(portfolioData.holdings2025.accountsByNumber).map(([accountNum, account]) => {
                                            const accountName = portfolioData.accountNames[accountNum];
                                            const accountGain = account.value - account.costBasis;
                                            const accountGainPct = account.costBasis > 0 ? (accountGain / account.costBasis) * 100 : 0;
                                            const percentage = (account.value / currentValue) * 100;

                                            // Skip zero-value accounts
                                            if (account.value === 0) return null;

                                            return (
                                                <div key={accountNum} className="bg-slate-800/50 rounded-xl p-5 border border-slate-700 hover:border-slate-600 transition-all">
                                                    <div className="flex justify-between items-start mb-3">
                                                        <div>
                                                            <h3 className="font-semibold text-lg text-slate-200">{accountName}</h3>
                                                            <p className="text-sm text-slate-500">{account.holdings} holdings · {accountNum}</p>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-xl font-bold text-slate-100">{formatCurrency(account.value)}</div>
                                                            <div className={`text-sm font-semibold ${accountGain >= 0 ? 'text-emerald-400' : 'text-red-400'}`}>
                                                                {formatCurrency(accountGain)} ({formatPercent(accountGainPct)})
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="relative h-2 bg-slate-700/50 rounded-full overflow-hidden">
                                                        <div 
                                                            className="absolute h-full bg-gradient-to-r from-emerald-400 to-cyan-400 rounded-full transition-all duration-500"
                                                            style={{ width: `${percentage}%` }}
                                                        />
                                                    </div>
                                                    <div className="text-xs text-slate-500 mt-2">{percentage.toFixed(1)}% of portfolio</div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === '2025' && (
                            <div className="space-y-6 animate-fadeIn">
                                {/* Summary Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-2xl p-6">
                                        <h3 className="text-slate-400 text-sm font-medium mb-4">Portfolio Growth in 2025</h3>
                                        <div className="text-4xl font-bold text-cyan-400 mb-2">{formatCurrency(totalChange)}</div>
                                        <div className="text-lg text-cyan-400 font-semibold">{formatPercent(totalChangePct)}</div>
                                    </div>

                                    <div className="bg-gradient-to-br from-cyan-900/30 to-blue-900/30 backdrop-blur-sm border border-cyan-500/50 rounded-2xl p-6 shadow-lg shadow-cyan-500/20">
                                        <h3 className="text-slate-300 text-sm font-medium mb-4">True Market Gain</h3>
                                        <div className="text-4xl font-bold text-cyan-400 mb-2">{formatCurrency(marketGain)}</div>
                                        <div className="text-lg text-cyan-400 font-semibold">{formatPercent(marketGainPct)} ROIC</div>
                                    </div>
                                </div>

                                {/* Waterfall Analysis */}
                                <div className="bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-2xl p-8">
                                    <h2 className="text-2xl font-bold mb-6 flex items-center gap-3">
                                        <BarChart3 />
                                        2025 Waterfall Analysis
                                    </h2>

                                    <div className="space-y-6">
                                        {/* Starting Value */}
                                        <div className="flex justify-between items-center p-5 bg-slate-800/50 rounded-xl border border-slate-700">
                                            <div className="flex items-center">
                                                <div className="w-3 h-3 bg-blue-500 rounded-full mr-4" />
                                                <span className="font-semibold text-lg">Starting Value (2024)</span>
                                            </div>
                                            <span className="text-2xl font-bold text-blue-400">{formatCurrency(startValue)}</span>
                                        </div>

                                        {/* Cash Moves Section */}
                                        <div className="ml-8 pl-6 border-l-2 border-slate-700 space-y-4">
                                            <div className="text-slate-400 font-semibold mb-3">Cash Moves</div>
                                            
                                            <div className="flex justify-between items-center p-4 bg-slate-800/30 rounded-lg">
                                                <div className="flex items-center">
                                                    <ArrowUpRight />
                                                    <span className="text-slate-300 ml-3">2025 Purchases</span>
                                                </div>
                                                <span className="text-lg font-semibold text-green-400">+{formatCurrency(portfolioData.transactions2025.purchases)}</span>
                                            </div>

                                            <div className="flex justify-between items-center p-4 bg-slate-800/30 rounded-lg">
                                                <div className="flex items-center">
                                                    <ArrowUpRight />
                                                    <span className="text-slate-300 ml-3">Dividends Reinvested</span>
                                                </div>
                                                <span className="text-lg font-semibold text-green-400">+{formatCurrency(portfolioData.transactions2025.dividendsReinvested)}</span>
                                            </div>

                                            <div className="flex justify-between items-center p-4 bg-slate-800/30 rounded-lg">
                                                <div className="flex items-center">
                                                    <ArrowDownRight />
                                                    <span className="text-slate-300 ml-3">2025 Sales</span>
                                                </div>
                                                <span className="text-lg font-semibold text-red-400">-{formatCurrency(portfolioData.transactions2025.sales)}</span>
                                            </div>

                                            <div className="flex justify-between items-center p-5 bg-emerald-900/20 rounded-xl border border-emerald-700/50">
                                                <span className="font-semibold">Net Cash Inflows</span>
                                                <span className="text-xl font-bold text-emerald-400">+{formatCurrency(netInflows)}</span>
                                            </div>
                                        </div>

                                        {/* Market Move */}
                                        <div className="ml-8 pl-6 border-l-2 border-slate-700">
                                            <div className="text-slate-400 font-semibold mb-3">Market Moves</div>
                                            
                                            <div className="flex justify-between items-center p-5 bg-gradient-to-r from-cyan-900/30 to-blue-900/30 rounded-xl border border-cyan-600/50">
                                                <div>
                                                    <span className="font-semibold text-lg">Market Gain (Price Appreciation)</span>
                                                    <div className="text-sm text-slate-400 mt-1">Pure performance excluding cash flows</div>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-2xl font-bold text-cyan-400">{formatCurrency(marketGain)}</div>
                                                    <div className="text-sm text-cyan-400 font-semibold">{formatPercent(marketGainPct)} ROIC</div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Ending Value */}
                                        <div className="flex justify-between items-center p-5 bg-gradient-to-r from-emerald-900/40 to-cyan-900/40 rounded-xl border border-emerald-500/50 shadow-lg shadow-emerald-500/20">
                                            <div className="flex items-center">
                                                <div className="w-3 h-3 bg-emerald-400 rounded-full mr-4" />
                                                <span className="font-semibold text-lg">Ending Value (2025)</span>
                                            </div>
                                            <span className="text-3xl font-bold text-emerald-400">{formatCurrency(endValue)}</span>
                                        </div>
                                    </div>

                                    {/* Summary Equation */}
                                    <div className="mt-8 p-6 bg-slate-800/30 rounded-xl border border-slate-700">
                                        <div className="text-center text-slate-300 font-mono text-sm">
                                            <span className="text-blue-400 font-semibold">{formatCurrency(startValue)}</span>
                                            {' + '}
                                            <span className="text-emerald-400 font-semibold">{formatCurrency(netInflows)}</span>
                                            {' + '}
                                            <span className="text-cyan-400 font-semibold">{formatCurrency(marketGain)}</span>
                                            {' = '}
                                            <span className="text-emerald-400 font-bold text-base">{formatCurrency(endValue)}</span>
                                        </div>
                                        <div className="text-center text-xs text-slate-500 mt-2">
                                            Start Value + Net Inflows + Market Gain = End Value
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<PortfolioDashboard />, document.getElementById('root'));
    </script>
</body>
</html>
